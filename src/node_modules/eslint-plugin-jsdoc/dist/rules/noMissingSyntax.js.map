{"version":3,"sources":["../../src/rules/noMissingSyntax.js"],"names":["setDefaults","state","selectorMap","incrementSelector","selector","comment","context","node","info","sourceCode","options","contexts","foundContext","find","cntxt","esquery","matches","parse","visitorKeys","contextStr","contextSelected","exit","length","report","loc","start","column","line","message","some","contextKey","undefined","minimum","Object","values","every","cmmnt","data","end","matchContext","meta","docs","description","url","fixable","schema","additionalProperties","properties","items","anyOf","type"],"mappings":"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","sourcesContent":["import esquery from 'esquery';\nimport iterateJsdoc from '../iterateJsdoc';\n\nconst setDefaults = (state) => {\n  if (!state.selectorMap) {\n    state.selectorMap = {};\n  }\n};\n\nconst incrementSelector = (state, selector, comment) => {\n  if (!state.selectorMap[selector]) {\n    state.selectorMap[selector] = {};\n  }\n\n  if (!state.selectorMap[selector][comment]) {\n    state.selectorMap[selector][comment] = 0;\n  }\n\n  state.selectorMap[selector][comment]++;\n};\n\nexport default iterateJsdoc(({\n  context,\n  node,\n  info: {\n    comment,\n  },\n  sourceCode,\n  state,\n}) => {\n  if (!context.options[0]) {\n    // Handle error later\n    return;\n  }\n\n  const {\n    contexts,\n  } = context.options[0];\n\n  const foundContext = contexts.find((cntxt) => {\n    return typeof cntxt === 'string' ?\n      esquery.matches(node, esquery.parse(cntxt), null, {\n        visitorKeys: sourceCode.visitorKeys,\n      }) :\n      (!cntxt.context || cntxt.context === 'any' || esquery.matches(node, esquery.parse(cntxt.context), null, {\n        visitorKeys: sourceCode.visitorKeys,\n      })) &&\n        comment === cntxt.comment;\n  });\n\n  const contextStr = typeof foundContext === 'object' ?\n    foundContext.context ?? 'any' :\n    foundContext;\n\n  setDefaults(state);\n\n  incrementSelector(state, contextStr, comment);\n}, {\n  contextSelected: true,\n  exit ({\n    context,\n    state,\n  }) {\n    if (!context.options.length) {\n      context.report({\n        loc: {\n          start: {\n            column: 1,\n            line: 1,\n          },\n        },\n        message: 'Rule `no-missing-syntax` is missing a `context` option.',\n      });\n\n      return;\n    }\n\n    setDefaults(state);\n\n    const {\n      contexts,\n    } = context.options[0];\n\n    // Report when MISSING\n    contexts.some((cntxt) => {\n      const contextStr = typeof cntxt === 'object' ? cntxt.context ?? 'any' : cntxt;\n      const comment = cntxt?.comment ?? '';\n\n      const contextKey = contextStr === 'any' ? undefined : contextStr;\n\n      if (\n        (!state.selectorMap[contextKey] ||\n        !state.selectorMap[contextKey][comment] ||\n        state.selectorMap[contextKey][comment] < (cntxt?.minimum ?? 1)) &&\n        (contextStr !== 'any' || Object.values(state.selectorMap).every((cmmnt) => {\n          return !cmmnt[comment] || cmmnt[comment] < (cntxt?.minimum ?? 1);\n        }))\n      ) {\n        const message = cntxt?.message ?? 'Syntax is required: {{context}}' +\n          (comment ? ' with {{comment}}' : '');\n        context.report({\n          data: {\n            comment,\n            context: contextStr,\n          },\n          loc: {\n            end: {\n              line: 1,\n            },\n            start: {\n              line: 1,\n            },\n          },\n          message,\n        });\n\n        return true;\n      }\n\n      return false;\n    });\n  },\n  matchContext: true,\n  meta: {\n    docs: {\n      description: 'Reports when certain comment structures are always expected.',\n      url: 'https://github.com/gajus/eslint-plugin-jsdoc#eslint-plugin-jsdoc-rules-no-missing-syntax',\n    },\n    fixable: 'code',\n    schema: [\n      {\n        additionalProperties: false,\n        properties: {\n          contexts: {\n            items: {\n              anyOf: [\n                {\n                  type: 'string',\n                },\n                {\n                  additionalProperties: false,\n                  properties: {\n                    comment: {\n                      type: 'string',\n                    },\n                    context: {\n                      type: 'string',\n                    },\n                    message: {\n                      type: 'string',\n                    },\n                    minimum: {\n                      type: 'integer',\n                    },\n                  },\n                  type: 'object',\n                },\n              ],\n            },\n            type: 'array',\n          },\n        },\n        type: 'object',\n      },\n    ],\n    type: 'suggestion',\n  },\n});\n"],"file":"noMissingSyntax.js"}